---
import Tracking from '../page-helpers/Tracking.astro';
import { generalMetaTags } from '../content-helpers/metaTags';
import { getLocale } from 'astro-i18n-aut';
import generalDataGetter from '../content-helpers/general';
import { pageRoutes } from '../content-helpers/pageRoutes';
import Main from '../components/MainContainer/MainContainer';
import Footer from '../components/Footer/Footer';
import Section from '../components/Section/Section';
import Jumbotron from '../components/Jumbotron/Jumbotron';
import Form from '../components/Form/Form';
import Link from '../components/Link/Link';
import Navigation from '../components/Navigation/Navigation';
import Button from '../components/Button/Button';

const locale = getLocale(Astro.url);
const generalData = generalDataGetter(locale);
const path = Astro.url.pathname;

const {
  pageTitle,
  pageMetaTags,
  isHome = false,
  hideContactForm = false,
} = Astro.props;

const metaTags = [
  ...generalMetaTags(Astro.generator),
  ...pageMetaTags || [],
];

const title = pageTitle || generalData.siteData.title;

---

<!doctype html>
<html lang={locale}>
  <head>
    <title>{`${title} | Vorhall KLG`}</title>
    <link rel="icon" type="image/svg+xml" href="/favicon-beta.svg" />

    {metaTags.map((tag) => <meta {...tag} />)}

    <script>
      import FlyingFocus from '../helpers/flying-focus/flying-focus';

      window.flyingFocus = new FlyingFocus();
    </script>

    <style is:global lang="scss">
      @import '../styles/global';
    </style>

    <link rel="sitemap" href="https://vorhall.com/sitemap-index.xml" />
    <link rel="preconnect" href="https://cdn.squeaky.ai" crossorigin />
    <link rel="preconnect" href="https://api.squeaky.ai/graphql" crossorigin />

  </head>
  <body>
    <section aria-label="Skiplinks">
      <Button {...generalData.siteData.skipLinkData} />
    </section>

    {!isHome &&
      <Navigation>
        <Button {...generalData.siteData.homeButtonData} />
      </Navigation>
    }

    <Main {...generalData.mainData}>

      <slot />

      {!hideContactForm &&
        <Section
          highlight
          fullWidth
        >
          <Jumbotron {...generalData.jumbotronContact} />

          <Form
            client:load
            {...generalData.contactFormData}
          >

            <div slot="privacyNote">
              <p>{generalData.contactFormData.privacyNote.preLink} <Link href={pageRoutes(locale).dataPrivacy} secondary="true" prefetch={true}>{generalData.contactFormData.privacyNote.link}</Link> {generalData.contactFormData.privacyNote.postLink}</p>
            </div>
          </Form>

        </Section>

      }
    </Main>

    <Footer {...generalData.footerData(locale, path)}/>

    <Tracking />
  </body>
</html>
